(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{566:function(t,e,n){"use strict";n.r(e);var a=n(148),o=n.n(a),i=n(70),r=n.n(i),s=n(16),l=n.n(s),u=n(9),c=n.n(u),d=n(12),p=n.n(d),f=n(19),h=n.n(f),g=n(528),v=n.n(g),m=n(18),y=n.n(m),x=n(527),w=n.n(x),P=n(149),_=n(1),b=_.o.fp64LowPart,S=[0,0,0,255],k={radiusScale:1,radiusMinPixels:0,radiusMaxPixels:w.a,strokeWidth:1,outline:!1,fp64:!1,getPosition:function(t){return t.position},getRadius:function(t){return t.radius||1},getColor:function(t){return t.color||S}},C=function(t){function e(){return c()(this,e),h()(this,(e.__proto__||l()(e)).apply(this,arguments))}return y()(e,t),p()(e,[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float outline;\nuniform float strokeWidth;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  // Multiply out radius and clamp to limits\n  float outerRadiusPixels = clamp(\n    project_scale(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n\n  // outline is centered at the radius\n  // outer radius needs to offset by half stroke width\n  outerRadiusPixels += outline * strokeWidth / 2.0;\n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  // 0 - solid circle, 1 - stroke with lineWidth=0\n  innerUnitRadius = outline * (1.0 - strokeWidth / outerRadiusPixels);\n\n  vec2 pixelOffset = unitPosition / 2.0 * outerRadiusPixels;\n  pixelOffset.y *= -1.0;\n\n  // vec3 offset = positions * outerRadiusPixels;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0));\n  gl_Position += project_pixel_to_clipspace(pixelOffset);\n\n  // Apply opacity to instance color, or return instance picking color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0 || distToCenter < innerUnitRadius) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.is64bitEnabled()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.state.attributeManager.addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:_.g.UNSIGNED_BYTE,accessor:"getColor",defaultValue:[0,0,0,255]}})}},{key:"updateState",value:function(t){var n=t.props,a=t.oldProps,o=t.changeFlags;if(v()(e.prototype.__proto__||l()(e.prototype),"updateState",this).call(this,{props:n,oldProps:a,changeFlags:o}),n.fp64!==a.fp64){var i=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(i)}),this.state.attributeManager.invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,a=n.radiusScale,o=n.radiusMinPixels,i=n.radiusMaxPixels,s=n.outline,l=n.strokeWidth;this.state.model.render(r()({},e,{outline:s?1:0,strokeWidth:l,radiusScale:a,radiusMinPixels:o,radiusMaxPixels:i}))}},{key:"_getModel",value:function(t){return new _.i(t,r()(this.getShaders(),{id:this.props.id,geometry:new _.h({drawMode:_.g.TRIANGLE_FAN,attributes:{positions:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.is64bitEnabled();if(t.isGeneric=!e,e){var n=this.props,a=n.data,i=n.getPosition,r=t.value,s=0,l=!0,u=!1,c=void 0;try{for(var d,p=o()(a);!(l=(d=p.next()).done);l=!0){var f=i(d.value);r[s++]=b(f[0]),r[s++]=b(f[1])}}catch(t){u=!0,c=t}finally{try{!l&&p.return&&p.return()}finally{if(u)throw c}}}else t.value=new Float32Array(2)}}]),e}(P.Layer);e.default=C;C.layerName="ScatterplotLayer",C.defaultProps=k},867:function(t,e,n){"use strict";n.r(e);var a=n(16),o=n.n(a),i=n(19),r=n.n(i),s=n(18),l=n.n(s),u=n(70),c=n.n(u),d=n(9),p=n.n(d),f=n(12),h=n.n(f),g=n(529),v=n.n(g),m=n(3),y=n(149),x=y.experimental.OrbitViewport,w={fov:50,near:1,far:100,translationX:0,translationY:0,zoom:1},P={minZoom:0,maxZoom:1/0};function _(t,e){return v()(t)?t:e}var b=function(){function t(e){var n=e.width,a=e.height,o=e.distance,i=e.bounds,r=e.lookAt,s=e.fov,l=e.near,u=e.far,c=e.translationX,d=e.translationY,f=e.zoom,h=e.minZoom,g=e.maxZoom,v=e.startPanViewport,m=e.startPanPos,y=e.isPanning,x=(e.startRotateViewport,e.isRotating,e.startZoomViewport),b=e.startZoomPos;p()(this,t),this._viewportProps=this._applyConstraints({width:n,height:a,distance:o,bounds:i,lookAt:r,fov:_(s,w.fov),near:_(l,w.near),far:_(u,w.far),translationX:_(c,w.translationX),translationY:_(d,w.translationY),zoom:_(f,w.zoom),minZoom:_(h,P.minZoom),maxZoom:_(g,P.maxZoom)}),this._interactiveState={startPanViewport:v,startPanPos:m,isPanning:y,startZoomViewport:x,startZoomPos:b}}return h()(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,n=new x(this._viewportProps);return this._getUpdatedOrbitState({startPanPos:e,startPanViewport:n})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,a=this._interactiveState.startPanPos||n,o=this._interactiveState.startPanViewport||new x(this._viewportProps),i=e[0]-a[0],r=e[1]-a[1],s=o.project(o.lookAt),l=o.unproject([s[0]-i,s[1]-r,s[2]]);return this._getUpdatedOrbitState({lookAt:l,isPanning:!0})}},{key:"panEnd",value:function(){return this._getUpdatedOrbitState({startPanViewport:null,startPanPos:null,isPanning:null})}},{key:"rotateStart",value:function(){return this._getUpdatedOrbitState()}},{key:"rotate",value:function(){return this._getUpdatedOrbitState()}},{key:"rotateEnd",value:function(){return this._getUpdatedOrbitState()}},{key:"zoomStart",value:function(t){var e=t.pos,n=new x(this._viewportProps);return this._getUpdatedOrbitState({startZoomViewport:n,startZoomPos:e})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,a=t.scale,o=this._viewportProps,i=o.zoom,r=o.minZoom,s=o.maxZoom,l=o.width,u=o.height,c=this._interactiveState.startZoomPos||n||e,d=this._interactiveState.startZoomViewport||new x(this._viewportProps),p=Object(m.d)(i*a,r,s),f=e[0]-c[0],h=e[1]-c[1],g=c[0]-l/2,v=u/2-c[1],y=d.project(d.lookAt),w=y[0]-g+g*p/i+f,P=y[1]+v-v*p/i-h,_=d.unproject([w,P,y[2]]);return this._getUpdatedOrbitState({lookAt:_,zoom:p})}},{key:"zoomEnd",value:function(){return this._getUpdatedOrbitState({startZoomPos:null})}},{key:"_getUpdatedOrbitState",value:function(e){return new t(c()({},this._viewportProps,this._interactiveState,e))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,a=t.zoom;return t.zoom=a>e?e:a,t.zoom=a<n?n:a,t}}]),t}(),S=function(t){function e(t){p()(this,e);var n=r()(this,(e.__proto__||o()(e)).call(this,b,t));return n.invertPan=!0,n}return l()(e,t),e}(y.Controller);e.default=S},912:function(t,e,n){"use strict";(function(t){var a,o=this&&this.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__assign||Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};Object.defineProperty(e,"__esModule",{value:!0});var r=n(6),s=n(6),l=n(523);n(893);var u=n(568),c=n(149),d=c.DeckGL,p=c.COORDINATE_SYSTEM,f=c.OrbitView,h=c.TextLayer,g=n(867).default,v=n(566).default,m={distance:.75,zoom:5e-4,width:window.innerWidth,height:window.innerHeight},y=new f,x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={scale:3,quantile:.995,text:{base:"dot",count:"dot"},data:{base:[],count:[]}},e.getScales=function(){var t=e.state,n=t.scale,a=t.quantile,o=t.data,i=o.base,r=o.count,s=i.reduce(function(t,e){return[Math.min(t[0],e.x),Math.max(t[1],e.x)]},[1/0,-1/0]),l=i.reduce(function(t,e){return[Math.min(t[0],e.y),Math.max(t[1],e.y)]},[1/0,-1/0]),c=[r.map(function(t){return t.z}).reduce(function(t,e){return Math.min(t,e)},1/0),u.quantile(r.map(function(t){return t.z}).sort(function(t,e){return t>e?1:t<e?-1:0}),a)];return{x:u.scaleLinear().domain(s).range([-1e3,1e3]),y:u.scaleLinear().domain(l).range([-1e3,1e3]),z:u.scalePow(.5).domain(c).range([1,16*n]).clamp(!0)}},e.getBaseLayer=function(){var t=e.state,n=t.text,a=t.data,o=e.getScales();return"text"===n.base?new h({id:"baseLayer-text",data:a.base,coordinateSystem:p.IDENTITY,fontFamily:"Fira Code, Monaco, monospace",getText:function(t){return t.text},getPosition:function(t){var e=t.x,n=t.y;return[o.x(e),o.y(n)]},getSize:function(){return 16},getColor:function(){return[128,128,128,64]}}):new v({id:"baseLayer-dot",data:a.base,coordinateSystem:p.IDENTITY,getPosition:function(t){var e=t.x,n=t.y;return[o.x(e),o.y(n)]},getRadius:3,getColor:function(){return[88,88,88,64]}})},e.getCountLayer=function(){var t=e.state,n=t.text,a=t.data,o=e.getScales();return"text"===n.count?new h({id:"countLayer-text",data:a.count,coordinateSystem:p.IDENTITY,fontFamily:"Fira Code, Monaco, monospace",getText:function(t){return t.text},getPosition:function(t){var e=t.x,n=t.y;return[o.x(e),o.y(n)]},getSize:function(t){var e=t.z;return o.z(e)},getColor:[255,0,0,255]}):new v({id:"countLayer-dot",data:a.count,coordinateSystem:p.IDENTITY,getPosition:function(t){var e=t.x,n=t.y;return[o.x(e),o.y(n)]},getRadius:function(t){var e=t.z;return o.z(e)},getColor:[255,0,0,255]})},e.handleViewChange=function(t){return function(n){var a;e.setState(((a={})[t]=n.target.value,a.data=i({},e.state.data,{count:e.state.data.count.slice()}),a))}},e.parseCsv=function(t){return u.csvParseRows(t,function(t){return{text:t[0],x:+t[1],y:+t[2],z:+t[3]}})},e.handleDataScale=function(t){return function(n){var a=n.target.files[0];if(a){var o=new FileReader;o.onload=function(){var n,a=e.parseCsv(o.result);e.setState({data:i({},e.state.data,(n={},n[t]=a,n))})},o.readAsText(a)}}},e.handleKeyDown=function(t){32===t.keyCode&&(t.shiftKey?e.setState({text:i({},e.state.text,{base:"text"===e.state.text.base?"dot":"text"})}):e.setState({text:i({},e.state.text,{count:"text"===e.state.text.count?"dot":"text"})}),e.setState({data:{base:e.state.data.base.slice(),count:e.state.data.count.slice()}}))},e}return o(e,t),e.prototype.componentDidMount=function(){window.addEventListener("keydown",this.handleKeyDown)},e.prototype.componentWillUnmount=function(){window.removeEventListener("keydown",this.handleKeyDown)},e.prototype.render=function(){var t=this.state,e=t.scale,n=t.quantile,a=[this.getBaseLayer(),this.getCountLayer()];return r.createElement("div",{className:"w-100 h-100 f7 bg-foreground-100"},r.createElement(d,{width:"100%",height:"100%",initialViewState:m,views:[y],layers:a,controller:g}),r.createElement("div",{className:"absolute top-1 left-1 pa1 background-100 bg-foreground-80"},r.createElement("div",{className:"h1 pa1 flex flex-row items-center"},r.createElement("label",{className:"db w3 flex-none"},"Scale:"),r.createElement("input",{className:"db flex-auto",type:"range",value:e,min:"1",max:"16",step:"0.1",onChange:this.handleViewChange("scale")})),r.createElement("div",{className:"h1 pa1 flex flex-row items-center"},r.createElement("label",{className:"db w3 flex-none"},"Quantile:"),r.createElement("input",{className:"db flex-auto",type:"range",value:n,min:"0.95",max:"1",step:"0.001",onChange:this.handleViewChange("quantile")}))),r.createElement("div",{className:"absolute top-1 right-1 pa1 background-100 bg-foreground-80"},r.createElement("div",{className:"h1 pa1 flex flex-row items-center"},r.createElement("label",{className:"db w3 flex-none"},"Base:"),r.createElement("input",{type:"file",className:"db flex-auto",onChange:this.handleDataScale("base")})),r.createElement("div",{className:"h1 pa1 flex flex-row items-center"},r.createElement("label",{className:"db w3 flex-none"},"Topic:"),r.createElement("input",{type:"file",className:"db flex-auto",onChange:this.handleDataScale("count")}))))},e}(s.PureComponent);l.storiesOf("Component",t).add("basic",function(){return r.createElement(x,null)})}).call(this,n(96)(t))},913:function(t,e,n){var a={"./story.tsx":912};function o(t){var e=i(t);return n(e)}function i(t){var e=a[t];if(!(e+1)){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}return e}o.keys=function(){return Object.keys(a)},o.resolve=i,t.exports=o,o.id=913},916:function(t,e,n){n(443),n(915),t.exports=n(914)}},[[916,1,2]]]);
//# sourceMappingURL=preview.a326886bd76fc088efcf.bundle.js.map